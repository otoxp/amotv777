
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Amorim IPTV</title>

<!-- Bootstrap utilities for quick responsive helpers (optional) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- HLS.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.1/dist/hls.min.js"></script>

<style>
  :root{
    --sidebar-w:320px;
    --bg:#0f0f10;
    --panel:#121214;
    --muted:#bfc3c6;
    --accent:#f0ad4e;
    --glass: rgba(255,255,255,0.03);
  }

  html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:Inter,Segoe UI,Arial; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
  .app{display:flex;height:100vh;overflow:hidden;position:relative}
  /* header (mobile) */
  .topbar{display:flex;align-items:center;gap:8px;padding:10px 12px;background:linear-gradient(0deg, rgba(255,255,255,0.02), transparent);border-bottom:1px solid rgba(255,255,255,0.03);z-index:20}
  .hamburger{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
  .app-title{font-weight:600;font-size:18px;margin-left:6px}
  .search-inline{flex:1;display:flex;align-items:center;margin-left:8px}

  input#search{width:100%;border-radius:10px;border:none;padding:10px;background:#0f0f10;color:var(--muted);outline:none;font-size:14px;border:1px solid rgba(255,255,255,0.02)}

  /* sidebar */
  .sidebar{width:var(--sidebar-w);background:#141416;border-right:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;transition:transform .28s ease, box-shadow .28s ease;z-index:30}
  .sidebar .head{padding:16px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;gap:8px}
  .sidebar .head h3{margin:0;font-weight:600;font-size:16px}
  .groups{overflow:auto;padding:8px 8px 24px 8px}
  .group-item{padding:12px 12px;border-radius:8px;margin:6px 6px;color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:space-between}
  .group-item:hover{background:rgba(255,255,255,0.02);color:#fff}
  .group-title{font-weight:600}
  .channels-list{margin:6px 0 12px 12px;list-style:none;padding:0;display:none}
  .channels-list li{display:flex;align-items:center;gap:12px;padding:8px;border-radius:8px;margin:4px 6px 4px 0;cursor:pointer;color:var(--muted)}
  .channels-list li:hover{background:rgba(255,255,255,0.02);color:#fff}
  .ch-logo{width:78px;height:48px;object-fit:cover;border-radius:6px;flex-shrink:0}
  .ch-meta{display:flex;flex-direction:column;min-width:0}
  .ch-name{font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .ch-sub{font-size:12px;color:rgba(255,255,255,0.45);margin-top:3px}

  /* main area */
  .main{flex:1;display:flex;flex-direction:column;height:100%}
  .tabs{background:#131315;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;gap:8px;padding:8px 12px;align-items:center;z-index:10}
  .tabs .tab{padding:8px 12px;border-radius:8px;color:var(--muted);cursor:pointer;font-size:14px}
  .tabs .tab.active{background:rgba(255,255,255,0.02);color:#fff}
  .player-wrap{flex:1;display:flex;align-items:center;justify-content:center;position:relative;padding:8px;min-height:220px}
  video#video{width:100%;height:100%;background:#000;border-radius:8px;outline:none;max-height:100%;object-fit:contain;display:block}
  .placeholder{position:absolute;left:16px;top:16px;color:var(--muted);font-size:16px;display:flex;align-items:center;gap:10px;z-index:2}
  /* small player controls and safe area */
  .player-controls-bar{position:absolute;right:14px;top:14px;z-index:3;display:flex;gap:8px;align-items:center}
  .btn-compact{height:40px;padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);display:inline-flex;align-items:center;gap:8px;cursor:pointer}

  .vod-grid{padding:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;overflow:auto}
  .vod-card{background:#111;border-radius:8px;padding:8px;display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer}
  .vod-card img{width:140px;height:200px;object-fit:cover;border-radius:6px}
  .vod-title{font-size:14px;text-align:center;color:var(--muted)}

  /* overlay for mobile menu */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);backdrop-filter:blur(3px);opacity:0;visibility:hidden;transition:opacity .28s ease, visibility .28s ease;z-index:25}
  .overlay.show{opacity:1;visibility:visible}

  /* mobile behaviour */
  @media (max-width:900px){
    :root{--sidebar-w:280px;}
    .ch-logo{width:64px;height:40px}
  }
  @media (max-width:700px){
    .sidebar{position:fixed;left:0;top:0;bottom:0;transform:translateX(-110%);box-shadow:0 12px 30px rgba(0,0,0,0.6);width:var(--sidebar-w);border-right:0}
    .sidebar.open{transform:translateX(0);}
    .topbar{position:relative;z-index:30}
    .search-inline{display:none} /* use header search space smaller on narrow screens */
    .app{height:100vh}
    .player-wrap{padding:6px;min-height:calc(100vh - 118px)} /* leave space for header and tabs */
    video#video{border-radius:6px}
    .placeholder{left:12px;top:12px;font-size:14px}
    .tabs{position:relative;z-index:15}
  }

  /* touch friendly clickable sizes */
  .group-item, .channels-list li, .tab, .btn-compact { touch-action:manipulation; -webkit-tap-highlight-color: rgba(0,0,0,0.1); }

  /* subtle scrollbar for groups/vod */
  .groups::-webkit-scrollbar, .vod-grid::-webkit-scrollbar {height:8px;width:8px}
  .groups::-webkit-scrollbar-thumb, .vod-grid::-webkit-scrollbar-thumb {background:rgba(255,255,255,0.03);border-radius:8px}
</style>
</head>
<body>
<div class="app" id="appRoot">

  <!-- Overlay (mobile menu) -->
  <div class="overlay" id="menuOverlay" aria-hidden="true"></div>

  <!-- Sidebar (will slide over content on mobile) -->
  <aside class="sidebar" id="sidebar" aria-label="Menu lateral">
    <div class="head">
      <img src="https://via.placeholder.com/40x40?text=A" alt="Amorim" width="40" height="40" style="border-radius:8px;object-fit:cover">
      <h3>Amorim IPTV</h3>
    </div>

    <div style="padding:10px 12px;border-bottom:1px solid rgba(255,255,255,0.03)">
      <input id="searchSidebar" placeholder="Buscar canal / VOD..." aria-label="Buscar canal" />
    </div>

    <div class="groups" id="groupsContainer">
      <div style="color:var(--muted);padding:12px">Carregando lista...</div>
    </div>

    <div style="margin-top:auto;padding:12px;border-top:1px solid rgba(255,255,255,0.03);font-size:13px;color:var(--muted)">
      <div>VersÃ£o: 1.0</div>
      <div style="margin-top:6px">Suporte: contato@rapaduratec.cc</div>
    </div>
  </aside>

  <!-- Main area -->
  <main class="main" id="mainContent">
    <!-- top bar (mobile + desktop) -->
    <div class="topbar">
      <button class="hamburger" id="hamburger" aria-label="Abrir menu" title="Menu">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
      </button>

      <div class="app-title">Amorim IPTV</div>

      <div class="search-inline" style="max-width:520px;">
        <input id="search" placeholder="Buscar canal / VOD..." aria-label="Buscar canal principal" />
      </div>

      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <button class="btn-compact" id="btnRefresh" title="Recarregar lista">â†»</button>
      </div>
    </div>

    <div class="tabs" role="tablist">
      <div class="tab active" data-tab="tv" role="tab" aria-selected="true">TV</div>
      <div class="tab" data-tab="vod" role="tab" aria-selected="false">VOD</div>
    </div>

    <div class="player-wrap" id="playerWrap">
      <div class="placeholder" id="playerPlaceholder">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" style="opacity:0.9"><path d="M5 3v18l15-9L5 3z" fill="currentColor"/></svg>
        <div>Selecione um canal ou VOD para reproduzir</div>
      </div>

      <video id="video" controls playsinline webkit-playsinline></video>

      <div class="player-controls-bar" id="playerControls">
        <button class="btn-compact" id="btnMute" title="Mudo">ðŸ”ˆ</button>
        <button class="btn-compact" id="btnPiP" title="Picture-in-Picture">â¤¢</button>
      </div>
    </div>

    <!-- VOD grid (aparece na aba VOD) -->
    <div id="vodSection" style="display:none">
      <div style="padding:12px;color:var(--muted);font-weight:600">VOD â€” selecione uma categoria na busca ou veja tudo</div>
      <div class="vod-grid" id="vodGrid"></div>
    </div>
  </main>
</div>

<script>
/* === CONFIG === */
const m3uUrl = 'https://tinyurl.com/plamo999'; // sua lista (substitua se quiser)
/* =========== */

let channels = []; // todos os itens lidos
let groupsMap = {}; // group -> [items]
let activeTab = 'tv';

/* util */ function el(tag, cls='', txt=''){ const e=document.createElement(tag); if(cls) e.className=cls; if(txt) e.textContent=txt; return e; }

/* ========== MENU MOBILE ========== */
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('menuOverlay');
const hamburger = document.getElementById('hamburger');
function openMenu(){ sidebar.classList.add('open'); overlay.classList.add('show'); document.body.style.overflow='hidden'; }
function closeMenu(){ sidebar.classList.remove('open'); overlay.classList.remove('show'); document.body.style.overflow=''; }
hamburger.addEventListener('click', ()=>{ if(sidebar.classList.contains('open')) closeMenu(); else openMenu(); });
overlay.addEventListener('click', closeMenu);

/* sync search inputs */
const searchMain = document.getElementById('search');
const searchSidebar = document.getElementById('searchSidebar');
[searchMain, searchSidebar].forEach(s=>{
  s.addEventListener('input', ()=>{
    const v=s.value;
    searchMain.value = v;
    searchSidebar.value = v;
    onSearchInput();
  });
});

/* reload button */
document.getElementById('btnRefresh').addEventListener('click', ()=>{ loadM3U(); });

/* Play via Hls.js */
let hlsInstance = null;
function playChannel(url, meta){
  const video = document.getElementById('video');
  document.getElementById('playerPlaceholder').style.display='none';
  if(!url){ alert('URL do canal invÃ¡lida.'); return; }
  if(hlsInstance){ try{ hlsInstance.destroy(); }catch(e){} hlsInstance=null; }
  if(Hls.isSupported()){
    hlsInstance = new Hls();
    hlsInstance.loadSource(url);
    hlsInstance.attachMedia(video);
    hlsInstance.on(Hls.Events.MANIFEST_PARSED, ()=> video.play().catch(()=>{}));
    hlsInstance.on(Hls.Events.ERROR, (ev,data)=>{ console.warn('HLS error',data); });
  } else if(video.canPlayType('application/vnd.apple.mpegurl')){
    video.src = url;
    video.addEventListener('loadedmetadata', ()=> video.play().catch(()=>{}), {once:true});
  } else {
    alert('Seu navegador nÃ£o suporta HLS.');
  }
  // mobile: close menu after selecting a channel for better UX
  if(window.innerWidth <= 700) closeMenu();
}

/* load m3u */
async function loadM3U(){
  const cont = document.getElementById('groupsContainer');
  cont.innerHTML = '<div style="color:var(--muted);padding:12px">Carregando lista...</div>';
  try{
    const res = await fetch(m3uUrl, {cache:'no-store'});
    const text = await res.text();
    parseM3U(text);
    buildGroupsUI();
    renderVODGrid();
  }catch(err){
    cont.innerHTML = '<div style="padding:12px;color:#f66">Erro ao carregar a lista M3U.</div>';
    console.error(err);
  }
}

/* parse simplificado */
function parseM3U(data){
  const lines = data.split(/\r?\n/);
  channels = [];
  for(let i=0;i<lines.length;i++){
    const l = lines[i].trim();
    if(!l) continue;
    if(l.startsWith('#EXTINF')){
      const nameMatch = l.match(/tvg-name="([^"]+)"/);
      const name = (nameMatch && nameMatch[1]) ? nameMatch[1] : (l.split(',')[1] || 'Sem Nome');
      const groupMatch = l.match(/group-title="([^"]+)"/);
      const group = (groupMatch && groupMatch[1]) ? groupMatch[1] : 'Sem Grupo';
      const logoMatch = l.match(/tvg-logo="([^"]+)"/);
      const logo = (logoMatch && logoMatch[1]) ? logoMatch[1] : null;
      const url = (lines[i+1] && lines[i+1].trim()) ? lines[i+1].trim() : '';
      const isVOD = url.toLowerCase().includes('vod') || url.toLowerCase().includes('.mp4') || url.toLowerCase().includes('.mkv');
      let category = '';
      if(isVOD){
        const lower = name.toLowerCase();
        if(lower.includes('filme')||lower.includes('movie')) category='Filmes';
        else if(lower.includes('novela')||lower.includes('soap')) category='Novelas';
        else category='Mini SÃ©ries';
      }
      const item = { name: name.trim(), group, logo, url, isVOD, category };
      channels.push(item);
      i++;
    }
  }

  groupsMap = {};
  channels.forEach(c=>{
    const key = c.group || 'Sem Grupo';
    if(!groupsMap[key]) groupsMap[key]=[];
    groupsMap[key].push(c);
  });
}

/* build UI */
function buildGroupsUI(filterQuery=''){
  const container = document.getElementById('groupsContainer');
  container.innerHTML = '';
  const groups = Object.keys(groupsMap).sort((a,b)=>a.localeCompare(b,'pt'));
  if(!groups.length){ container.innerHTML = '<div style="padding:12px;color:var(--muted)">Nenhum grupo encontrado.</div>'; return; }
  groups.forEach(group=>{
    const groupItems = groupsMap[group].filter(c=> {
      if(!filterQuery) return true;
      const q = filterQuery.toLowerCase();
      return c.name.toLowerCase().includes(q) || group.toLowerCase().includes(q);
    });
    if(filterQuery && groupItems.length===0) return;
    const gWrap = el('div','group-wrap');
    const gItem = el('div','group-item');
    const title = el('div','group-title', group);
    const count = el('div','group-count', `(${groupItems.length})`);
    count.style.color='rgba(255,255,255,0.45)';
    gItem.appendChild(title); gItem.appendChild(count);
    gWrap.appendChild(gItem);
    const chUl = el('ul','channels-list');
    if(filterQuery && groupItems.length>0) chUl.style.display='block';
    groupItems.forEach(ch=>{
      if(activeTab==='tv' && ch.isVOD) return;
      if(activeTab==='vod' && !ch.isVOD) return;
      const li = el('li');
      const img = document.createElement('img');
      img.className='ch-logo'; img.loading='lazy';
      img.src = ch.logo || (ch.isVOD ? 'https://via.placeholder.com/140x200?text=VOD' : 'https://via.placeholder.com/80x50?text=Logo');
      img.alt = ch.name;
      const meta = el('div','ch-meta');
      const nm = el('div','ch-name', ch.name);
      const sub = el('div','ch-sub', ch.isVOD ? ch.category : group);
      meta.appendChild(nm); meta.appendChild(sub);
      li.appendChild(img); li.appendChild(meta);
      li.addEventListener('click', (ev)=>{ ev.stopPropagation(); playChannel(ch.url, ch); });
      chUl.appendChild(li);
    });
    gItem.addEventListener('click', ()=>{
      const currently = chUl.style.display;
      document.querySelectorAll('.channels-list').forEach(u=>{ if(u!==chUl) u.style.display='none'; });
      chUl.style.display = (currently==='block') ? 'none' : 'block';
    });
    gWrap.appendChild(chUl);
    container.appendChild(gWrap);
  });
}

/* VOD grid */
function renderVODGrid(filterQ=''){
  const grid = document.getElementById('vodGrid');
  grid.innerHTML = '';
  const vods = channels.filter(c=>c.isVOD && (!filterQ || c.name.toLowerCase().includes(filterQ.toLowerCase())));
  if(vods.length===0){ grid.innerHTML = '<div style="color:var(--muted);padding:18px">Nenhum VOD encontrado.</div>'; return; }
  vods.forEach(v=>{
    const card = el('div','vod-card');
    const img = document.createElement('img'); img.loading='lazy'; img.src = v.logo || 'https://via.placeholder.com/140x200?text=VOD';
    const title = el('div','vod-title', v.name);
    card.appendChild(img); card.appendChild(title);
    card.addEventListener('click', ()=> playChannel(v.url, v) );
    grid.appendChild(card);
  });
}

/* search handling with debounce */
let searchTimer = null;
function onSearchInput(){
  clearTimeout(searchTimer);
  searchTimer = setTimeout(()=>{
    const q = (searchMain.value || '').trim();
    if(q===''){ buildGroupsUI(''); if(activeTab==='vod') renderVODGrid(''); }
    else { buildGroupsUI(q); if(activeTab==='vod') renderVODGrid(q); }
  },180);
}

searchMain.addEventListener('input', onSearchInput);

/* tabs logic */
document.querySelectorAll('.tabs .tab').forEach(t=>{
  t.addEventListener('click', ()=>{
    document.querySelectorAll('.tabs .tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    activeTab = t.dataset.tab;
    buildGroupsUI(document.getElementById('search').value.trim());
    if(activeTab==='vod'){ document.getElementById('vodSection').style.display='block'; document.getElementById('groupsContainer').style.display='none'; }
    else { document.getElementById('vodSection').style.display='none'; document.getElementById('groupsContainer').style.display='block'; }
    // on mobile, close menu so user sees content
    if(window.innerWidth <= 700) closeMenu();
  });
});

/* optional small controls */
document.getElementById('btnMute').addEventListener('click', ()=>{
  const video = document.getElementById('video'); video.muted = !video.muted;
  document.getElementById('btnMute').textContent = video.muted ? 'ðŸ”‡' : 'ðŸ”ˆ';
});
document.getElementById('btnPiP').addEventListener('click', async ()=>{
  const video = document.getElementById('video');
  try{ if(document.pictureInPictureElement) await document.exitPictureInPicture(); else await video.requestPictureInPicture(); }
  catch(e){ console.warn('PiP not available', e); alert('Picture-in-Picture indisponÃ­vel neste navegador.'); }
});

/* initial load */
loadM3U();

/* enhance UX: close menu on resize desktop */
window.addEventListener('resize', ()=>{
  if(window.innerWidth > 700){ closeMenu(); }
});

/* prevent accidental double-tap zoom on iOS */
let lastTouch = 0;
document.addEventListener('touchend', (e)=>{
  const now = Date.now();
  if(now - lastTouch <= 300) e.preventDefault();
  lastTouch = now;
}, {passive:false});

</script>
</body>
</html>
