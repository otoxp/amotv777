
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SS IPTV Amorim</title>
  <meta name="description" content="Painel IPTV pessoal — SS IPTV Amorim" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2143a8">
  <link rel="icon" href="assets/icon-192.png" />
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.0/dist/hls.min.js"></script>
  <style>
    :root{
      --bg:#071024;
      --card:#071535;
      --primary:#2143a8;
      --accent:#1e90ff;
      --muted:#9ca3af;
      color-scheme: dark;
    }
    html,body{height:100%; margin:0; background:linear-gradient(180deg,var(--bg), #02102a); color:#e6eef8; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;}
    .topbar{display:flex; align-items:center; gap:16px; padding:12px 18px; background:linear-gradient(90deg, rgba(33,67,168,0.95), rgba(16,40,90,0.85)); box-shadow:0 4px 14px rgba(0,0,0,0.4);}
    .logo{display:flex; align-items:center; gap:12px;}
    .logo img{height:48px; border-radius:6px;}
    .brand{font-size:18px; font-weight:700; letter-spacing:0.6px;}
    .subtitle{font-size:12px; color:rgba(230,238,248,0.85); margin-top:2px;}
    .app{display:grid; grid-template-columns:300px 1fr; gap:16px; padding:18px;}
    .sidebar{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); padding:12px; border-radius:10px; min-height:calc(100vh - 120px);}
    input,select,button{width:100%; padding:8px 10px; margin:8px 0; border-radius:8px; border:1px solid rgba(255,255,255,0.05); background:transparent; color:inherit;}
    .groups{max-height:44vh; overflow:auto; margin-top:6px;}
    .group{padding:8px; border-radius:8px; cursor:pointer; margin-bottom:6px; background:transparent}
    .group:hover{background:rgba(255,255,255,0.02)}
    .channel-list{display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:10px; margin-top:12px;}
    .channel{background:rgba(255,255,255,0.02); padding:8px; border-radius:8px; cursor:pointer; font-size:14px; display:flex; align-items:center; gap:8px;}
    .channel img{width:44px; height:28px; object-fit:cover; border-radius:6px;}
    .player-wrap{display:flex; flex-direction:column; height:100%;}
    video{width:100%; height:56vh; background:black; border-radius:10px;}
    .meta{display:flex; justify-content:space-between; align-items:center; margin-top:10px; gap:8px;}
    .muted{color:var(--muted); font-size:13px}
    .controls{display:flex; gap:8px;}
    @media(max-width:900px){.app{grid-template-columns:1fr; padding:12px} video{height:38vh}}
    /* focus for remote keys */
    .channel:focus, .group:focus {outline:2px solid var(--accent); box-shadow:0 0 6px rgba(30,144,255,0.12)}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="logo">
      <img src="assets/logo.png" alt="SS IPTV Amorim logo">
      <div>
        <div class="brand">SS IPTV Amorim</div>
        <div class="subtitle">Seu painel pessoal de IPTV — azul royal</div>
      </div>
    </div>
  </div>

  <div class="app">
    <aside class="sidebar">
      <div class="muted">Carregando lista automaticamente... se preferir cole outra URL.</div>
      <input id="m3uUrl" placeholder="Colar URL M3U (ou deixe padrão)" />
      <input id="fileInput" type="file" accept=".m3u,.txt" />
      <input id="search" placeholder="Buscar canal..." />
      <select id="groupSelect"><option value="__all">Todos os grupos</option></select>
      <div style="margin-top:10px;">
        <button id="loadBtn">Carregar lista</button>
      </div>
      <div style="margin-top:12px;">
        <strong>Canais</strong>
        <div class="groups" id="groupsContainer"></div>
      </div>
    </aside>

    <main class="main">
      <div class="player-wrap">
        <video id="player" controls playsinline></video>
        <div class="meta">
          <div>
            <div id="currentTitle" style="font-weight:600">Nenhum canal selecionado</div>
            <div class="muted" id="currentGroup">—</div>
          </div>
          <div class="controls">
            <button id="fullscreenBtn">Tela cheia</button>
            <button id="openInNew">Abrir em nova aba</button>
          </div>
        </div>

        <div id="channels" class="channel-list" style="margin-top:12px"></div>
      </div>
    </main>
  </div>

<script>
const M3U_URL = 'https://tinyurl.com/plamo99i';
const player = document.getElementById('player');
const channelsEl = document.getElementById('channels');
const groupSelect = document.getElementById('groupSelect');
const groupsContainer = document.getElementById('groupsContainer');
const searchInput = document.getElementById('search');
const currentTitle = document.getElementById('currentTitle');
const currentGroup = document.getElementById('currentGroup');

let channels = [];

function parseM3U(text){
  const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l!=='');
  const result = [];
  let lastMeta = null;
  for(const line of lines){
    if(line.startsWith('#EXTINF')){
      lastMeta = line;
    } else if(!line.startsWith('#')){
      const url = line;
      let title = url;
      let group = 'Sem grupo';
      let logo = '';
      if(lastMeta){
        const gMatch = lastMeta.match(/group-title="([^"]+)"/i);
        const lMatch = lastMeta.match(/tvg-logo="([^"]+)"/i);
        group = gMatch ? gMatch[1] : group;
        logo = lMatch ? lMatch[1] : '';
        const afterComma = lastMeta.split(',').slice(1).join(',').trim();
        if(afterComma) title = afterComma;
      }
      result.push({title, url, group, logo});
      lastMeta = null;
    }
  }
  return result;
}

function renderGroups(){
  const byGroup = {};
  channels.forEach(ch => { byGroup[ch.group] = byGroup[ch.group] || []; byGroup[ch.group].push(ch); });
  groupSelect.innerHTML = '<option value="__all">Todos os grupos</option>';
  groupsContainer.innerHTML = '';
  Object.keys(byGroup).sort().forEach(g=>{
    const opt = document.createElement('option'); opt.value = g; opt.textContent = g; groupSelect.appendChild(opt);
    const btn = document.createElement('div'); btn.className='group'; btn.tabIndex=0; btn.textContent = g + ' ('+byGroup[g].length+')';
    btn.onclick = ()=>{ groupSelect.value = g; filterAndRender(); btn.focus(); };
    btn.onkeypress = (e)=>{ if(e.key==='Enter') btn.onclick(); };
    groupsContainer.appendChild(btn);
  });
}

function filterAndRender(){
  const q = searchInput.value.trim().toLowerCase();
  const sel = groupSelect.value;
  const filtered = channels.filter(ch=>{
    if(sel !== '__all' && ch.group !== sel) return false;
    if(q && !(ch.title.toLowerCase().includes(q) || (ch.group && ch.group.toLowerCase().includes(q)))) return false;
    return true;
  });
  renderChannels(filtered);
}

function renderChannels(list){
  channelsEl.innerHTML = '';
  if(list.length === 0){ channelsEl.innerHTML = '<div class="muted">Nenhum canal encontrado.</div>'; return; }
  list.forEach((ch, idx)=>{
    const el = document.createElement('div'); el.className='channel'; el.tabIndex=0;
    const img = document.createElement('img'); img.src = ch.logo || 'https://via.placeholder.com/88x48?text=TV';
    const title = document.createElement('div'); title.style.flex='1';
    const tMain = document.createElement('div'); tMain.textContent = ch.title;
    const tSub = document.createElement('div'); tSub.textContent = ch.group; tSub.className='muted'; tSub.style.fontSize='12px';
    title.appendChild(tMain); title.appendChild(tSub);
    el.appendChild(img); el.appendChild(title);
    el.onclick = ()=> playChannel(ch);
    el.onkeypress = (e)=>{ if(e.key==='Enter') el.onclick(); };
    el.dataset.index = idx;
    channelsEl.appendChild(el);
  });
}

function playChannel(ch){
  currentTitle.textContent = ch.title;
  currentGroup.textContent = ch.group;
  const url = ch.url;
  if(Hls.isSupported() && url.match(/\.m3u8($|\?)/i)){
    if(window._hls) { window._hls.destroy(); window._hls = null; }
    const hls = new Hls({capLevelToPlayerSize:true});
    window._hls = hls;
    hls.loadSource(url);
    hls.attachMedia(player);
    hls.on(Hls.Events.MANIFEST_PARSED, function() { player.play().catch(()=>{}); });
  } else {
    player.src = url;
    player.play().catch(()=>{});
  }
}

document.getElementById('loadBtn').addEventListener('click', async ()=>{
  const url = document.getElementById('m3uUrl').value.trim() || M3U_URL;
  if(!url){
    alert('Cole a URL M3U ou envie um arquivo .m3u no campo "Escolher arquivo".');
    return;
  }
  try{
    const resp = await fetch(url);
    if(!resp.ok) throw new Error('Erro ao baixar M3U: '+resp.status);
    const txt = await resp.text();
    channels = parseM3U(txt);
    renderGroups(); filterAndRender();
  } catch(err){
    alert('Falha ao carregar lista: ' + err.message + '\nSe for CORS, cole o link direto bruto (raw).');
  }
});

document.getElementById('fileInput').addEventListener('change', async (ev)=>{
  const f = ev.target.files[0]; if(!f) return;
  const txt = await f.text();
  channels = parseM3U(txt);
  renderGroups(); filterAndRender();
});

searchInput.addEventListener('input', filterAndRender);
groupSelect.addEventListener('change', filterAndRender);

document.getElementById('fullscreenBtn').addEventListener('click', ()=>{
  if(document.fullscreenElement) document.exitFullscreen();
  else document.documentElement.requestFullscreen();
});
document.getElementById('openInNew').addEventListener('click', ()=>{
  const src = player.currentSrc || player.src;
  if(!src){ alert('Nenhum stream ativo'); return; }
  window.open(src, '_blank');
});

// keyboard remote (setas + enter)
document.addEventListener('keydown', (e)=>{
  const active = document.activeElement;
  if(e.key === 'ArrowDown' || e.key === 'ArrowUp'){
    const items = Array.from(document.querySelectorAll('.channel'));
    let idx = items.indexOf(active);
    if(idx === -1) idx = 0;
    if(e.key === 'ArrowDown') idx = Math.min(items.length-1, idx+1);
    if(e.key === 'ArrowUp') idx = Math.max(0, idx-1);
    items[idx] && items[idx].focus();
    e.preventDefault();
  } else if(e.key === 'Enter'){
    if(active && active.classList.contains('channel')) active.click();
  } else if(e.key === 'Backspace' || e.key === 'Escape'){
    document.getElementById('search').focus();
  }
});

// auto load
window.addEventListener('load', ()=>{
  document.getElementById('m3uUrl').value = M3U_URL;
  document.getElementById('loadBtn').click();
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('/service-worker.js').catch(()=>{}); }
});
</script>
</body>
</html>
